{% extends "baseAdmin.html.twig" %}



{% block body %}

<div class="main-panel">
	<div class="content-wrapper">
		{% if app.user.getRoles()=="ROLE_SUPER_USER" %}
			<button type="button" class="btn btn-success mb-2" data-toggle="modal" data-target="#exampleModal">
				Add tresorie +
			</button>
		{% endif %}
			
		<div class="">
			<div class="col-lg-12 grid-margin stretch-card">
				<div class="card">
					{% for message in app.flashes('success') %}
						<div class="alert alert-success">
							{{ message }}
						</div>
					{% endfor %}
					<div class="card-body">
						<h4 class="card-title">Liste des tresories</h4>
						<h3 class="card-header font-italic font-weight-bold text-capitalize text-center text-primary">{{pays.nom}}</h3>
						<div class="table-responsive">
							<table class="table table-bordered">
								<thead>
									<tr>
										<th>
											Banque nom
										</th>
										<th>
											Solde réel
										</th>
										<th>
											Montant entrée
										</th>
										<th>
											Montant sortie
										</th>
										<th>
											Solde après mouvement
										</th>
										<th>
											Date
										</th>
										{# {% if app.user.getRoles()=='ROLE_ADMIN' %}
											<th>
												Actions
											</th>
										{% endif %} #}
									</tr>
								</thead>
								<tbody>
								{% set sum = 0 %}
									{% for item in tresories %}
										<tr>
											<td>
												{{item.banque.nom}}
											</td>
											<td>
												{{item.solder}}											
											</td>
											<td>
												{{item.entree}}
											</td>
											<td>
												{{item.sortie}}
											</td>
											<td>
												{{ item.solder + item.entree - item.sortie }}
											</td>
											 <td>
												{{ item.date | date('d-m-Y') }}
											</td>

											{% set sum = sum + (item.solder + item.entree - item.sortie)  %}
											
											{# <td>
												{{item.banque.pays.nom}}
											</td> #}
											{# {% if app.user.getRoles()=='ROLE_ADMIN' %} #}
												<td>
													<a href="{{path('app_edit_tresorie', {'id': item.id})}}" class="btn btn-success btn-sm">Edit</a>
													{# <a href="{{path('app_historique_tresorie_by_bank', {'id': item.id})}}" class="btn btn-info btn-sm">show</a> #}
												</td>
											{# {% endif %} #}

										</tr>
									{% endfor %}

									<tr>
										<th>Total</th>
										<td>
											<span id="sumSoldeReel">0</span>
										</td>
										<td colspan="2"></td>
										<td>
											{{sum}}
										</td>
									</tr>
								</tbody>
							</table>


						</div>
					</div>
				</div>
			</div>








            
		</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Ajouter tresorie</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
            	{{form(tresorieForm)}}   
			</div>
		</div>
	</div>
</div>



<script>
    // JavaScript code to calculate the sum of "Solde réel" and update the table
    document.addEventListener("DOMContentLoaded", function () {
        const soldeReelCells = document.querySelectorAll("tbody td:nth-child(2)"); // Select all "Solde réel" cells in the table body
        let sumSoldeReel = 0;

        // Calculate the sum of "Solde réel"
        soldeReelCells.forEach((cell) => {
            sumSoldeReel += parseFloat(cell.innerText); // Assuming the "Solde réel" values are numbers (can handle decimals)
        });

        // Update the value in the "Sum Solde réel" cell
        const sumSoldeReelCell = document.getElementById("sumSoldeReel");
        sumSoldeReelCell.innerText = sumSoldeReel;
    });
</script>








{% endblock %}